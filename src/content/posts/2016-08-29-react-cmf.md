---
title:  "React CMF : Un framework pour des applications React configurables"
categories: ["fr"]
tags: ["Talend", "React", "JavaScript", "Redux", "Framework"]
date: 2016-08-29
---

Mon premier défi : comment construire des applications React complètes de manière cohérente et configurable ? Après pas mal de discussion autours des differentes idées c'est devenu très clair: L'inversion de control IOC est la solutions.

C'est ainsi qu'est né **React CMF** (Content Management Framework), un framework pour créer des applications React configurables.

## Le problème

Avec Talend UI, nous avions résolu le problème des composants réutilisables. Mais construire une application complète nécessite bien plus que des composants :

- Comment gérer le routing ?
- Comment organiser le state management avec Redux ?
- Comment permettre la configuration de l'interface ?
- Comment réutiliser des patterns d'application entre différents produits ?

Chaque équipe réinventait sa propre architecture, avec ses propres conventions. Nous avions besoin d'un cadre commun, d'un framework qui dicte les bonnes pratiques tout en restant flexible.

## Pourquoi "CMF" ?

Le nom peut surprendre au premier abord. CMF pour Content Management Framework ? Mais nous ne construisons pas WordPress !

En réalité, la définition de Wikipedia d'un CMF colle parfaitement à notre besoin :

> "Un framework de gestion de contenu (CMF) est un système qui facilite l'utilisation de composants réutilisables ou de logiciels personnalisés pour gérer le contenu Web. Il partage des aspects d'un framework d'application Web et d'un système de gestion de contenu."

C'est exactement ce que nous voulions : un framework qui facilite la construction d'applications Web avec des composants réutilisables et configurables.

## Le paradigme

Avant de plonger dans les détails techniques, nous avons défini le paradigme fondamental de CMF :

**Un utilisateur interagit avec une vue** en utilisant sa souris et/ou son clavier, ce qui envoie des événements depuis un contenu. Cette interaction **dispatch une action**. Cette action peut changer la vue actuelle ou le contenu affiché.

Ce paradigme peut paraître simple, mais il structure toute l'architecture du framework.

## Les concepts fondamentaux

CMF repose sur trois concepts principaux :

### 1. Les Views (Vues)

Les vues sont des composants React spéciaux. Ce sont des composants de haut niveau avec une responsabilité claire : **distribuer les props aux composants configurables**.

Les vues sont appelées par la bibliothèque d'abstraction UI depuis le routeur et connectées au store via les settings. Une vue peut être un composant pur (pure component).

Une vue est composée de composants React qui peuvent récupérer leurs props de manière configurable.

### 2. Les Actions

Les actions sont simplement des actions Redux. Rien de révolutionnaire ici, mais leur intégration dans le système de configuration est la clé.

CMF fournit un registre d'action creators qui peuvent être référencés par configuration. Cela permet de changer le comportement de l'application sans toucher au code.

### 3. Les Content Types (Types de contenu)

Un content type définit des métadonnées sur un contenu. Par exemple, quand vous affichez une liste d'articles, vous dites que chaque élément de cette liste est un "article", qui est un content type.

CMF ajoute des métadonnées sur les content types :

- **title** : Le titre du type de contenu
- **icon id** : L'identifiant de l'icône à afficher
- **actions** : Les actions disponibles (organisées par catégorie)

Cette approche permet de configurer l'interface en fonction du type de contenu affiché.

## Le Registry : Le cœur du système

Au centre de CMF se trouve le **Registry** (registre). C'est une pièce maîtresse simple mais puissante : un système clé/objet avec préfixes pour stocker :

- Les **action creators** (fonctions)
- Les **views** (composants React)
- Les **configurations** de composants

Le Registry permet de référencer des éléments par leur nom plutôt que par import direct. Cela ouvre la porte à la configuration :

```javascript
// Au lieu de
import MyView from './MyView';

// On fait
const MyView = registry.getView('MyView');
```

Cette indirection permet de changer les vues, les actions et les comportements via configuration, sans recompiler l'application.

## L'architecture en pratique

Voici comment tout s'articule :

1. **Le routeur** appelle une vue basée sur l'URL
2. **La vue** récupère sa configuration depuis le Registry
3. **Les composants** de la vue reçoivent leurs props via cette configuration
4. **Les actions** sont dispatchées quand l'utilisateur interagit
5. **Le state Redux** est mis à jour
6. **Les composants** se re-rendent avec les nouvelles données

Tout est configurable, tout est prévisible, tout est testable.

## Les avantages

Cette architecture apporte plusieurs avantages majeurs :

### Configurabilité
Les applications peuvent être configurées sans recompilation. Changez la configuration, rechargez la page, et voilà !

### Réutilisabilité
Les patterns d'application sont réutilisables entre produits. Une fois qu'une vue est créée, elle peut être utilisée partout.

### Testabilité
Les composants purs, les actions Redux et la configuration séparée rendent le testing beaucoup plus simple.

### Maintenabilité
L'architecture claire et les conventions fortes facilitent la maintenance et l'onboarding de nouveaux développeurs.

### Extensibilité
Ajouter de nouvelles fonctionnalités est simplifié grâce au système de registry.

## Les défis

Créer un tel framework n'a pas été sans défis :

### La courbe d'apprentissage
CMF introduit des concepts supplémentaires. Les développeurs doivent comprendre le Registry, la configuration, et les conventions.

### L'équilibre flexibilité/contraintes
Trop de contraintes et le framework devient limitant. Pas assez, et on perd les bénéfices de standardisation.

### La documentation
Un framework sans documentation est inutile. Nous avons dû investir énormément dans la documentation et les exemples.

### Les performances
L'indirection du Registry a un coût. Nous avons dû optimiser pour que ce coût reste négligeable.

## L'évolution

CMF a évolué avec le temps :

- Support de React Router
- Intégration avec Redux Saga
- Amélioration du système de configuration
- Ajout de helpers et d'utilitaires
- Optimisation des performances

Chaque itération nous a rapprochés d'un framework mature et stable.

## Leçons apprises

Cette aventure nous a appris plusieurs choses :

1. **L'abstraction a un prix** : Chaque couche d'abstraction ajoute de la complexité. Il faut que les bénéfices justifient ce coût.

2. **La configuration est puissante** : Pouvoir changer le comportement sans recompiler ouvre de nombreuses possibilités.

3. **Les conventions libèrent** : Avoir des conventions fortes réduit la charge cognitive et accélère le développement.

4. **La documentation est critique** : Un framework sans documentation est un framework mort.

5. **L'itération est essentielle** : Nous n'avons pas créé le framework parfait du premier coup. Chaque retour utilisateur nous a aidés à l'améliorer.

## Conclusion

React CMF est le chaînon manquant entre une bibliothèque de composants (Talend UI) et des applications complètes. Il fournit l'architecture, les patterns et les conventions nécessaires pour construire des applications React configurables et maintenables.

Avec Talend UI pour les composants et React CMF pour l'architecture, nous avons créé un écosystème complet pour le développement d'applications React chez Talend.

Le framework continue d'évoluer, porté par les besoins réels des équipes de développement et les retours d'expérience de son utilisation en production.

Si vous construisez plusieurs applications React avec des patterns similaires, je vous encourage à explorer cette approche. La configurabilité et la réutilisabilité qu'elle apporte peuvent transformer votre façon de développer.

---

**Liens utiles :**

- [Talend UI sur GitHub](https://github.com/Talend/ui/)
- [React CMF Documentation](https://github.com/Talend/ui/tree/master/packages/cmf)
- [Redux](https://redux.js.org/)
- [React Router](https://reactrouter.com/)
