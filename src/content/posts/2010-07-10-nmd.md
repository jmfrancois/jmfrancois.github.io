---
title: Nantes-developpement.com
categories: ["en"]
tags: ["réalisation", "plone"]
date: 2010-07-10
---

I'm proud to announce it, the new website of "The Greater Nantes Economic Agency" is now available here: http://www.nantes-developpement.com.

This website uses Plone with some community add-ons (available on PyPI). Some of these are new, meaning they have been created to fit the customer needs, others have been contributed, meaning they have been modified upstream, and the last have just been used:

* collective.z3cform.norobots [new]
* collective.groupdashboard [used]
* collective.gallery [new]
* collective.dewplayer [new]
* collective.portlet.actions [used]
* collective.portlet.contact [new]
* collective.portlet.feedmixer [used]
* qi.portlet.TagClouds [contributed]
* collective.plonebookmarklets [contributed]
* collective.singing & collective.dancing [contributed]
* collective.contentlicensing [contributed]
* nmd.plonelinkasvideoembed [new]
* archetypes.uploadreferencewidget [contributed]
* babel [used]
* collective.autopermission [used]
* collective.contentrules.mail [used]
* collective.harlequin [new]
* collective.monkeypatcher [used]
* collective.z3cform.grok [new]
* collective.z3cform.norobots [new]
* Products.Maps [contributed]
* Products.PloneFormGen [contributed]
* Products.TinyMCE [contributed]
* Products.TextIndexNG3 [used]
* Products.CompoundField [contributed]
* Products.ZNagios [used]
* five.grok [used]
* experimental.contentcreation [used]
* experimental.aggressiveopaquespeedup [new]
* collective.remove.kss [new]
* collective.remove.kupu [new]
* collective.remove.rules [new]
* Products.CacheSetup [used]
* Products.MemcachedManager [used]
* plone.app.ldap [used]
* iw.fss [used]
* Relstorage [used]

Custom code contains:

* the theme done as a usual plonetheme (not with xdv).
* policy (integration of all community add-ons and plone configuration)
* portlets
* content-types (collection, folderish document, video/audio interview, …)

## System architecture

We have Apache2 in front end. Next we have Varnish as proxy cache (but not load balancer). Configuration has been taken from Products.PloneOrg Subversion. It is already compatible with Varnish 2.1.2

Next we have HAProxy as load balancer that dispatches requests over 4 Zope instances. Each Zope instance is configured with 2 threads (Zope default configuration is 4 threads).

For the database we use RelStorage with PostgreSQL, iw.fss to store files on the server's file system and OpenLDAP to store users.

## Monitoring & maintenance

We use Nagios & Cacti to monitor all services. We have split services into two categories:

* system services: apache, postgresql, memcached, ldap
* app services: varnish, haproxy, zope

This has some advantages: You can deploy the application without system services. This has been possible with buildout because it is very flexible. Supervisord and HAProxy have just been taken from the über buildout.

RelStorage has a script to export the database to any database format: MySQL, FileStorage (Data.fs) or whatever you want. So we use a script every night just after the backup to build a File Storage "Data.fs", so any developer can work without having to install system services and has the latest database available. It is easier to work on bugs when you have the content produced by the customer.

## What I would like to improve/add to Plone this year

For sure after a project like this one, I would like to contribute to Plone, share my experience. Here it is.

portlets dynamic template: I would like to be able to register new templates to provide multiple choices of portlet display. As you can choose how a content is displayed with dynamic view FTI feature, you should be able to choose how a portlet is displayed. I overrode collection and static portlet just to do that.

portlets order: I want to have first portlet for users & groups, next portlet for content types and next contextual portlets. To achieve this I overrode portlet mechanism because it was hardcoded.

## Performances

Plone 3 is slow. Right, but it is great. So how can I create a site with traffic and a newsletter of 8300 subscribers? Here are my keys:

install experimental add-ons listed below
install cachesetup with Varnish as proxy cache and configure both (debug is easy with Wireshark & Firebug)
configuration of Zope: 2 threads, object cache and jarn.checkinterval
externalize binary content: fss is the best for Plone 3. Use blob for Plone 4
collective.solr: I have tried out Solr but I was not satisfied: some Plone features are broken
add one instance only to deliver the newsletter. This one can not be reached by request, only the clock server
Because we followed the way Plone community does websites, we succeeded in creating a great website with only free (GNU & BSD) software. We are working on Linux desktop and we produce only free software because we love this.

The buildout used to deploy this website has been pushed to the collective Subversion under the name of nmd. Feel free to use it, to contribute, to share ideas. It has been designed to be usable in offline mode, and built upon reusable pieces depending on what you want.

I would like to thank the community for help, efforts, bug fixes and all great add-ons that have been created. I would like to thank nantes-developpement.com for this experience and their warm welcome of Plone.
